# Event Panel (Next.js + Supabase + Vercel)

Это стартовый репозиторий для онлайн-панели управления ивентами:
- **Ивенты**
- **Смета & Оплаты**
- **Меню (гости/стафф)**
- **Райдеры (документы + пункты)**
- **Тайминг & Задачи**

## 1) Создайте Supabase проект
1. Создайте проект в Supabase.
2. В разделе **SQL Editor** примените схему из: `db/schema.sql`.
3. В разделе **Authentication** включите email (можно magic-link).

Важно: используйте **anon key** (не service role) — в проекте включены RLS-политики "только владелец".

## 2) Локальный запуск
```bash
npm i
cp .env.example .env.local
npm run dev
```
Откройте `http://localhost:3000`.

## 3) Деплой на Vercel (GitHub)
1. Залейте папку в GitHub.
2. Импортируйте репозиторий в Vercel.
3. Добавьте env переменные:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
4. Deploy.

## 4) Импорт ивента из Excel (.xlsx)
Импорт создаёт **новый ивент** и наполняет его данными из книги.

### Что поддерживается
Обязательные листы:
- `Main` → `budget_items` (+ метаданные ивента: name/date/location/guests)
- `Decor` → `budget_items` + `payments` (оплачено/осталось)
- `Drinks` → `budget_items`
- `Staff and Staff Food` → `budget_items`
- `Staff from venue` → `budget_items`
- `Тайминг для стаффа` → `tasks`

Опциональные листы (если есть в файле):
- `Меню` → `menu_items` (guest)
- `Меню для стаффа` → `menu_items` (staff)
- любые листы начинающиеся с `Rider...` или содержащие `райдер` → `rider_docs` + `rider_items`

### Как импортировать (в интерфейсе)
1. Зайдите в панель и авторизуйтесь.
2. Откройте раздел **Ивенты**.
3. Нажмите кнопку **Импорт из Excel**.
4. Выберите `.xlsx` файл.
5. (Необязательно) заполните поля "Название/Дата/Локация/Гости" — это перезапишет то, что найдётся в файле.
6. Нажмите **Импортировать**.
7. Вы автоматически попадёте на созданный ивент.

### Как импортировать (через API, если нужно)
POST ` /api/import/xlsx ` (multipart/form-data)
- `file`: сам `.xlsx`
- `event_name` / `event_date` / `event_location` / `event_guests` (опционально)

## 5) Что дальше (полезные расширения)
- **Напоминания**: Vercel Cron + API route/Edge function, которая ежедневно проверяет:
  - платежи со статусом planned и ближайшей датой
  - задачи с дедлайном
  - критичные пункты райдера

- **Импорт в существующий ивент** (сейчас импорт создаёт новый) — легко добавить вторым режимом.
